var y=(B,J,Q={})=>{let M=`${B}=${J}`;if(Q&&typeof Q.maxAge==="number"&&Q.maxAge>=0)M+=`; Max-Age=${Math.floor(Q.maxAge)}`;if(Q.domain)M+=`; Domain=${Q.domain}`;if(Q.path)M+=`; Path=${Q.path}`;if(Q.expires)M+=`; Expires=${Q.expires.toUTCString()}`;if(Q.httpOnly)M+="; HttpOnly";if(Q.secure)M+="; Secure";if(Q.sameSite)M+=`; SameSite=${Q.sameSite}`;if(Q.partitioned)M+="; Partitioned";return M},f=(B)=>{const J=new Map,Q=new Map,M=()=>{const K=B.headers.get("cookie");if(K){var S=0;while(S<K.length){var P=K.indexOf("=",S);if(P===-1)break;var $=K.indexOf(";",S);if($===-1)$=K.length;else if($<P){S=K.lastIndexOf(";",P-1)+1;continue}var Y=K.slice(S,P).trim();if(!J.has(Y)){var U=K.slice(P+1,$).trim();if(U.charCodeAt(0)===34)U=U.slice(1,-1);J.set(Y,decodeURIComponent(U))}S=$+1}}};return{get:(K)=>{if(!J)M();return J.get(K)},set:(K,S,P)=>{Q.set(K,{value:S,options:P})},delete:(K,S)=>{Q.set(K,{value:"",options:{...S,expires:new Date(0)}})},cookiefy:(K)=>{if(Q.size>0)K.headers.set("Set-Cookie",Array.from(Q.entries()).map(([S,{value:P,options:$}])=>y(S,encodeURIComponent(P),$)).join("; "));return K}}};function T(B){return Object(B)!==B}function D(B){const J=Object.getPrototypeOf(B);return J===Object.prototype||J===null||Object.getOwnPropertyNames(J).sort().join("\0")===u}function E(B){return Object.prototype.toString.call(B).slice(8,-1)}var l=function(B){switch(B){case'"':return'\\"';case"<":return"\\u003C";case"\\":return"\\\\";case"\n":return"\\n";case"\r":return"\\r";case"\t":return"\\t";case"\b":return"\\b";case"\f":return"\\f";case"\u2028":return"\\u2028";case"\u2029":return"\\u2029";default:return B<" "?`\\u${B.charCodeAt(0).toString(16).padStart(4,"0")}`:""}};function O(B){let J="",Q=0;const M=B.length;for(let L=0;L<M;L+=1){const W=B[L],Z=l(W);if(Z)J+=B.slice(Q,L)+Z,Q=L+1}return`"${Q===0?B:J+B.slice(Q)}"`}class b extends Error{constructor(B,J){super(B);this.name="DevalueError",this.path=J.join("")}}var u=Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var V=-1,C=-2,H=-3,j=-4,N=-5,w=-6;function q(B,J){return x(JSON.parse(B),J)}function x(B,J){if(typeof B==="number")return L(B,!0);if(!Array.isArray(B)||B.length===0)throw new Error("Invalid input");const Q=B,M=Array(Q.length);function L(W,Z=!1){if(W===V)return;if(W===H)return NaN;if(W===j)return Infinity;if(W===N)return (-Infinity);if(W===w)return-0;if(Z)throw new Error("Invalid input");if(W in M)return M[W];const X=Q[W];if(!X||typeof X!=="object")M[W]=X;else if(Array.isArray(X))if(typeof X[0]==="string"){const K=X[0],S=J?.[K];if(S)return M[W]=S(L(X[1]));switch(K){case"Date":M[W]=new Date(X[1]);break;case"Set":const P=new Set;M[W]=P;for(let U=1;U<X.length;U+=1)P.add(L(X[U]));break;case"Map":const $=new Map;M[W]=$;for(let U=1;U<X.length;U+=2)$.set(L(X[U]),L(X[U+1]));break;case"RegExp":M[W]=new RegExp(X[1],X[2]);break;case"Object":M[W]=Object(X[1]);break;case"BigInt":M[W]=BigInt(X[1]);break;case"null":const Y=Object.create(null);M[W]=Y;for(let U=1;U<X.length;U+=2)Y[X[U]]=L(X[U+1]);break;default:throw new Error(`Unknown type ${K}`)}}else{const K=new Array(X.length);M[W]=K;for(let S=0;S<X.length;S+=1){const P=X[S];if(P===C)continue;K[S]=L(P)}}else{const K={};M[W]=K;for(let S in X){const P=X[S];K[S]=L(P)}}return M[W]}return L(0)}function _(B,J){const Q=[],M=new Map,L=[];for(let S in J)L.push({key:S,fn:J[S]});const W=[];let Z=0;function X(S){if(typeof S==="function")throw new b("Cannot stringify a function",W);if(M.has(S))return M.get(S);if(S===void 0)return V;if(Number.isNaN(S))return H;if(S===Infinity)return j;if(S===(-Infinity))return N;if(S===0&&1/S<0)return w;const P=Z++;M.set(S,P);for(let{key:Y,fn:U}of L){const G=U(S);if(G)return Q[P]=`["${Y}",${X(G)}]`,P}let $="";if(T(S))$=I(S);else switch(E(S)){case"Number":case"String":case"Boolean":$=`["Object",${I(S)}]`;break;case"BigInt":$=`["BigInt",${S}]`;break;case"Date":$=`["Date","${S.toISOString()}"]`;break;case"RegExp":const{source:U,flags:G}=S;$=G?`["RegExp",${O(U)},"${G}"]`:`["RegExp",${O(U)}]`;break;case"Array":$="[";for(let z=0;z<S.length;z+=1){if(z>0)$+=",";if(z in S)W.push(`[${z}]`),$+=X(S[z]),W.pop();else $+=C}$+="]";break;case"Set":$='["Set"';for(let z of S)$+=`,${X(z)}`;$+="]";break;case"Map":$='["Map"';for(let[z,R]of S)W.push(`.get(${T(z)?I(z):"..."})`),$+=`,${X(z)},${X(R)}`;$+="]";break;default:if(!D(S))throw new b("Cannot stringify arbitrary non-POJOs",W);if(Object.getOwnPropertySymbols(S).length>0)throw new b("Cannot stringify POJOs with symbolic keys",W);if(Object.getPrototypeOf(S)===null){$='["null"';for(let z in S)W.push(`.${z}`),$+=`,${O(z)},${X(S[z])}`,W.pop();$+="]"}else{$="{";let z=!1;for(let R in S){if(z)$+=",";z=!0,W.push(`.${R}`),$+=`${O(R)}:${X(S[R])}`,W.pop()}$+="}"}}return Q[P]=$,P}const K=X(B);if(K<0)return`${K}`;return`[${Q.join(",")}]`}var I=function(B){const J=typeof B;if(J==="string")return O(B);if(B instanceof String)return O(B.toString());if(B===void 0)return V.toString();if(B===0&&1/B<0)return w.toString();if(J==="bigint")return`["BigInt","${B}"]`;return String(B)};var c=(B)=>{try{return typeof B!=="string"?B:JSON.parse(B)}catch(J){return B}},m=(B,J="input")=>{let Q=0;const M=new FormData,L=_({[J]:B},{File:(W)=>{if(W instanceof File){const Z=`#FILE_${Q}_FILE#`;return M.set(Z,W),Q++,Z}}});return M.set(J,L),M},k=(B,J="input")=>{return q(B.get(J),{File:(Q)=>{return B.get(Q)}})[J]};var o=(B,J)=>{let Q=B;return J.forEach((M)=>{Q=Q?.[M]?Q?.[M]:void 0}),Q?Q:null},P0=({router:B,before:J=[],after:Q=[],locals:M={},cors:L,catch:W})=>({async fetch(Z,X,K){const S=new URL(Z.url),P=Z.headers.get("x-wrpc-client")==="true",$=S.pathname.split("/").filter(Boolean),Y=Z.method;if(Y!=="POST")$.push(Y.toLocaleLowerCase());const U=Object.assign(K,X,{locals:M},{request:Z,url:S,caches,cookies:f(Z),route:$.join("/")});let G,z=200,R=JSON.stringify({error:{message:"Not Found"}}),F={"Content-Type":"application/json"};S:try{for(let p of J.concat(L?.preflight||[])||[])if(G=p(U)??G,G)break S;const A=o(B,$),v=Y==="GET"?JSON.parse(decodeURIComponent(new URLSearchParams(S.search).get("input")||"{}")):P?k(await Z.formData()):await Z.json();if(A&&"call"in A)if(R=await A.call(U,A.parse(v)),R?.constructor.name==="ReadableStream")F["Content-Type"]="text/event-stream";else if(R&&R instanceof File)F={"Content-Type":R.type,"Content-Disposition":"attachment; filename="+R.name};else{if(!P)F={"Content-Type":P?'multipart/form-data; boundary="abcd"':"application/json"};else delete F["Content-Type"];R=P?m(R,"result"):JSON.stringify({result:R})}}catch(A){console.log({error:A}),G=W?.(A)||G,z=500,R=JSON.stringify({error:{message:c(A.message)||"Internal Server Error"}})}G=G||new Response(R,{headers:F,status:z});for(let A of Q.concat(L?.corsify||[])||[])G=A(G,U)||G;return G}});var Z0=(...B)=>{const J=async(M)=>{const L={};if(B)for(let W of B)Object.assign(L,await W(M));return L},Q=(M)=>(L)=>{return{parse:(W)=>{if(M===void 0)return;else{const Z=M.safeParse?.(W)||M._parse?.(W),X=Z?.error?.issues||Z.issues;if(X)throw console.log(W),new Error(JSON.stringify(X));return Z.data||Z.output}},call:async(W,Z)=>{return L({event:W,input:Z,ctx:await J(W)})}}};return{input:(M)=>({handle:Q(M)}),handle:Q(void 0)}};export{Z0 as procedure,P0 as createRouter};
